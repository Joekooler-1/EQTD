import tkinter as tk
from tkinter import filedialog, messagebox
import pandas as pd
import os
import tempfile

def display_selected_columns():
    # Define the indices of the columns to load and display (0-based indexing)
    selected_indices = [0, 2, 4, 5, 6]  # Adjust these indices based on the columns you want to display

    # Open file dialog to select the PSV file
    input_file = filedialog.askopenfilename(
        title="Select a PSV File", 
        filetypes=[("Pipe-Separated Values", "*.psv"), ("All Files", "*.*")]
    )
    
    if not input_file:
        return  # User cancelled the file dialog

    # Try to load the file with UTF-8 encoding, fallback to ISO-8859-1 if it fails
    try:
        # Attempt to read with UTF-8 encoding, loading only the selected columns
        data = pd.read_csv(input_file, sep='|', encoding='utf-8', usecols=selected_indices)
    except UnicodeDecodeError:
        # If UTF-8 fails, fallback to ISO-8859-1 encoding
        data = pd.read_csv(input_file, sep='|', encoding='ISO-8859-1', usecols=selected_indices)

    try:
        # Write to a temporary Excel file to open it for viewing
        with tempfile.NamedTemporaryFile(suffix=".xlsx", delete=False) as tmp:
            temp_filename = tmp.name
        data.to_excel(temp_filename, index=False)

        # Open the Excel file for viewing
        os.startfile(temp_filename, "open")

    except FileNotFoundError:
        messagebox.showerror("Error", "File not found.")
    except ValueError:
        messagebox.showerror("Error", "One or more specified column indices do not exist in the input file.")
    except Exception as e:
        messagebox.showerror("Error", f"An unexpected error occurred: {e}")

# Setting up the tkinter app
root = tk.Tk()
root.title("PSV Column Viewer")

# Button to load and display specific columns
load_button = tk.Button(root, text="Load PSV File", command=display_selected_columns)
load_button.pack(pady=20)

# Run the tkinter main loop
root.mainloop()
